<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IndianTravelShield</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/image/favicon_.ico" />

    <!-- Open Graph -->
    <meta property="og:title" content="india-auth-hub" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />

    <!-- Redirect fix for Vercel -->
    <script>
      if (!location.pathname.match(/^\/($|index\.html)/)) {
        sessionStorage.redirect = location.pathname;
        location.replace("/");
      }
    </script>

    <!-- Google Maps -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBU7z2W7aE4T6TSV7SqEk0UJiyjAC97UW8&libraries=places"
      async
      defer
    ></script>

    <!-- Ethers.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.4/dist/ethers.umd.min.js"></script>

    <style>
      /* Your existing styles */
      body { margin: 0; font-family: 'Inter', sans-serif; }
      #root { min-height: 100vh; }
      /* Language menu styles */
      #language-menu.notranslate { position: fixed; top: 55px; right: 20px; z-index: 9999; user-select: none; }
      #language-toggle { background: linear-gradient(135deg,#0078d7,#005bb5); color: #fff; padding:15px 18px; border-radius:12px; border:none; cursor:pointer; }
      #language-list { display:none; max-height:350px; overflow-y:auto; background:#fff; border-radius:12px; list-style:none; padding:6px 0; box-shadow:0 6px 20px rgba(0,0,0,0.15); }
      #language-list li { padding:10px 16px; cursor:pointer; transition:all 0.2s ease; }
      #language-list li:hover { background:#f0f6ff; padding-left:20px; color:#0078d7; }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <!-- Language menu -->
    <div id="language-menu" class="notranslate">
      <button id="language-toggle">üåç Language</button>
      <ul id="language-list"></ul>
    </div>
    <div id="google_translate_element"></div>

    <!-- Restore redirect -->
    <script>
      if (sessionStorage.redirect) {
        const redirectPath = sessionStorage.redirect;
        delete sessionStorage.redirect;
        history.replaceState(null,null,redirectPath);
      }
    </script>

    <!-- Google Translate -->
    <script>
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
      }
    </script>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- Language menu script -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('language-toggle');
        const list = document.getElementById('language-list');

        const languages = { en: 'English', hi: 'Hindi', bn: 'Bengali', es: 'Spanish', fr: 'French' };

        Object.entries(languages).forEach(([code, name]) => {
          const li = document.createElement('li');
          li.textContent = name;
          li.dataset.lang = code;
          list.appendChild(li);
        });

        toggle.addEventListener('click', () => {
          list.style.display = list.style.display === 'block' ? 'none' : 'block';
        });

        list.addEventListener('click', (e) => {
          if (e.target.tagName === 'LI') {
            const lang = e.target.dataset.lang;
            const select = document.querySelector('.goog-te-combo');
            if (select) { select.value = lang; select.dispatchEvent(new Event('change')); }
            list.style.display = 'none';
          }
        });
      });
    </script>

    <!-- Blockchain helper scripts -->
    <script>
      async function getEthereumAccount() {
        if (!window.ethereum) throw new Error("MetaMask not installed");
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        return accounts[0];
      }

      function generateUniqueId() {
        return window.ethers.keccak256(window.ethers.toUtf8Bytes(Date.now().toString() + Math.random()));
      }

      async function registerOnChain(uniqueId) {
        if (!window.ethereum) throw new Error("MetaMask not detected");
        const provider = new window.ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const contractAddress = 'YOUR_CONTRACT_ADDRESS'; // Replace
        const abi = [ "function register(bytes32 uniqueId) external" ];
        const contract = new window.ethers.Contract(contractAddress, abi, signer);

        const gasLimit = await contract.estimateGas.register(uniqueId);
        const tx = await contract.register(uniqueId, { gasLimit });
        await tx.wait();
        return tx.hash;
      }
    </script>

    <!-- Main app -->
    <script type="module">
      import App from '/src/main.tsx';
      // You can mount App manually if Lovable allows it
    </script>
  </body>
</html>
